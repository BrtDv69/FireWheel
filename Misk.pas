unit Misk;

interface

uses Windows, Registry, Classes, IBServices, SysUtils, Buttons, DB, wwdbigrd, wwDBGrid,
     IBCustomDataSet, Dialogs, Forms, Controls, Graphics, StrUtils,
     Grids, Menus, IBSQL, IBDataBase, cxGridDBTableView, cxGraphics, dxBarExtItems,
     cxGridTableView, cxCustomData, cxClasses, LbCipher, LbString, dxBarStrs,
     cxGridPopUpMenuConsts, cxGridStrs, cxFilterConsts, cxEditConsts, cxFilterControlStrs;

type
 TObjProcedure = procedure of object;
 TForm_Params = Record
   Left   : Integer;
   Top    : Integer;
   Width  : Integer;
   Height : Integer;
   State  : TWindowState;
 end;

const
  prro = $396A3CC6;

var
  GenPswd, UserName, Password : String;
  PersonID, Nakl_ID, StoreCard_ID : Integer;
  DefParams : TStrings;
  UserID : Integer;
  ColorGroups : TColor = $009EE1FE;
  ColorWorks : TColor = $00FFE49D;
  ColorGoods : TColor = clWindow;
  ColorUnModify : TColor = $00A6C8F0;
  ColorTyres : TColor = $0014A8F8;
  ColorAccumulators : TColor = $00B7FFFF;
  ColorUse100 : TColor = clRed;
  TempIn_Out, TmpGoodType : Integer;
  WorkDayLength : Integer = 8;

function GetPaths(var Path1, Path2, Path3 : String): Boolean;
procedure GetServer(var ServerName : String; var Protocol : TProtocol);
function MyUpCase(Ch : Char): Char;
function FieldPos(FieldName: String; SelectSQL: TStrings): String;
function FieldPosNumber(FieldPosRes, OrderBy: String): String;
procedure wwDBGridCalcTitleAttributes(Sender: TObject;
  AFieldName, AFieldNameReal: String; AFont: TFont; ABrush: TBrush;
  var ATitleAlignment: TAlignment; OrderBy: String);
procedure wwDBGridTitleButtonClick(Sender: TObject; AFieldName: String;
                                   var OrderBy : String; Ctrl : Boolean;
                                   sbApply, sbCancel : TSpeedButton;
                                   GenerateSelect : TObjProcedure);
procedure wwDBGridCalcTitleImage(Sender: TObject; Field: TField;
                                 var TitleImageAttributes: TwwTitleImageAttributes;
                                 OrderBy : String);
procedure ibdsAfterScroll(DataSet: TDataSet; Form: TForm; Suf: String);
function GetStartDate(Number_Restart_Period: Integer; Date: TDateTime): TDate;
function GetStopDate(Number_Restart_Period: Integer; Date: TDateTime): TDate;
function ReplaceDateStr(InStr: String; Date: TDateTime): String;
procedure wwDBGridCalcCellColors2(Sender: TObject;
  Field: TField; State: TGridDrawState; Highlight: Boolean; AFont: TFont;
  ABrush: TBrush);
procedure wwDBGridCalcCellColors3(Sender: TObject;
  Field: TField; State: TGridDrawState; Highlight: Boolean; AFont: TFont;
  ABrush: TBrush);
function GeneratePrice(BasePrice: Double; PriceFormula: String; Percent: Double; GetNSP: Integer; NSP: Double): Double;
procedure sbPrintClick(Sender: TComponent; ibsAux: TIBSQL; ibDataSet : TIBDataSet);
function CurrencyToStr (nSum : Longint; cTxt1,cTxt2,cTxt3 : String; nTypeWrite : Byte) : String;
procedure SetUserSelect(trMain : TIBTransaction; ibdsList : TIBDataSet; ibsAux : TIBSQL; TableID : Integer);
procedure ReadUserSelect(ibdsList : TIBDataSet; ibsAux : TIBSQL; TableID : Integer);
procedure GridDBTableViewCustomDrawColumnHeader(Sender: TcxGridDBTableView;
          ACanvas: TcxCanvas; AViewInfo: TcxGridColumnHeaderViewInfo);
function ReplaceStr(const S, Srch, Replace: string): string;
{ Returns string with every occurrence of Srch string replaced with
  Replace string. }
procedure AnsiLCase(var Source:AnsiString;const Index,Count:Integer);
procedure FlashMsg(const Title,Msg:AnsiString; TOut:Integer);
function  iMax(const I,J:Integer):Integer;
function GetNewID(ibsGen_ID: TIBSQL; Gen_Name: String): Integer;
procedure PostIfNeeded(IBDataSet: TIBDataSet);
function GetPassword(lblText : String; var Password : String) : Boolean;
//procedure LocaliseDevEx;
procedure SetUpRegionalSettings;
function MyInputQuery(FormCaption, LabelCaption, InputMask : String; var Value : Integer) : Boolean;

implementation

uses Main, EnterPassword, InputQuery;

function GetPaths(var Path1, Path2, Path3 : String): Boolean ;
var
 Reg: TRegistry;
begin
 Result := False;
 Reg := TRegistry.Create;
 Reg.RootKey := HKEY_LOCAL_MACHINE;
 If (Reg.KeyExists('\Software\WizardSoft\Wizard FireWork\SetUp')) then
  Begin
   Reg.OpenKey('\Software\WizardSoft\Wizard FireWork\SetUp',False);
   If (Reg.ValueExists('Path1')) then
    Begin
     Result := True;
     Path1 := Reg.ReadString('Path1');
     Path2 := Reg.ReadString('Path2');
     Path3 := Reg.ReadString('Path3')
    End
  End
 else
  Result := False;
 Reg.Free
End;

procedure GetServer(var ServerName : String; var Protocol : TProtocol);
 var Reg : TRegistry;
     Key256 : TKey256;
     Path : String;
begin
 Reg := TRegistry.Create;
 Reg.RootKey := HKEY_LOCAL_MACHINE;
 Reg.OpenKeyReadOnly('\Software\WizardSoft\Wizard FireWheel\SetUp');
 GenerateLMDKey(Key256, SizeOf(Key256), '¬¡ëìyW²Î=`áþÚ ÁºyX†f0“Úâš 845098yhfjb hJLUGLI,. ., **&*^#');
 Path := RDLEncryptStringCBCEx(Reg.ReadString('Path'), Key256, 32, False);
 Reg.Free;
 If (Copy(Path,1,2)='\\') then
  Begin
   ServerName := Copy(Path,3,Pred(Pos(':',Path)));
   Protocol := NamedPipe
  End
 else
  If (Copy(Path,2,2)=':\') then
   Begin
    ServerName := '';
    Protocol := Local
   End
  else
   Begin
    ServerName := Copy(Path,1,Pred(Pos(':',Path)));
    Protocol := TCP
   End
End;

function MyUpCase(Ch: Char): Char;
Begin
 If Ch in ['a'..'z'] then Ch := UpCase(Ch);
 If Ord(Ch) in [224..255] then Ch := Chr(Ord(Ch)-32);
 Result := Ch
End;

function FieldPos(FieldName: String; SelectSQL: TStrings): String;
 var SqlStr, S : String;
     k, kk : Integer;
Begin
 SqlStr :='';
 For k := 0 to Pred(SelectSQL.Count) do
  SqlStr := SqlStr+' '+Trim(SelectSQL[k])+' ';
 If (Pos('distinct',SqlStr)=0) then
  SqlStr := Copy(SqlStr,8,Pos(' from ',SqlStr)-7)
 else
  SqlStr := Copy(SqlStr,Pos(' distinct ',SqlStr)+11,Pos(' from ',SqlStr)-Pos(' distinct ',SqlStr)+10);
 SqlStr := Trim(SqlStr)+',';
 S := '';
 kk := 1;
 While (Length(SqlStr)>0) do
  Begin
   S := Trim(Copy(SqlStr,1,Pos(',',SqlStr)));
   If (CompareText(Copy(S,Length(S)-Length(FieldName),Length(FieldName)),FieldName)=0) and
      ((S[Length(S)-Length(FieldName)-1] in [' ','.',',']) or (Length(S)=Succ(Length(FieldName)))) then
    Break;
   SqlStr := Copy(SqlStr,Succ(Pos(',',SqlStr)),Length(SqlStr)-Pos(',',SqlStr));
   Inc(kk)
  End;
 Result := IntToStr(kk)
End;

procedure wwDBGridTitleButtonClick(Sender: TObject; AFieldName: String;
                                   var OrderBy : String; Ctrl : Boolean;
                                   sbApply, sbCancel : TSpeedButton;
                                   GenerateSelect : TObjProcedure);
 var BookMark : TBookMarkStr;
     Field : TField;
     FieldPosRes, PreStr, PastStr : String;
begin
 try
  Field := ((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName)
 except
  exit
 end;
 If (AFieldName <> '') and (Field.FieldKind=fkData) then
  Begin
   If (sbApply<>nil) and (sbApply.Enabled) then
    Case MessageDlg('Èìåþòñÿ íåñîõðàíåííûå èçìåíåíèÿ. Ñîõðàíèòü?', mtConfirmation, [mbYes,mbNo,mbCancel],0) of
     mrYes: sbApply.Click;
     mrNo: sbCancel.Click;
     mrCancel: Exit
    End;
   BookMark := ((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).BookMark;
   ((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).Close;
   FieldPosRes := FieldPos(AFieldName,((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).SelectSQL);
   If (Ctrl) then
    Begin
     If (Pos(' '+FieldPosRes+' ',OrderBy)>0) then
      Begin
       If (Pos(' '+FieldPosRes+' ',OrderBy)=1) then
        PreStr := ''
       else
        PreStr := Copy(OrderBy,1,Pos(' '+FieldPosRes+' ',OrderBy));
       OrderBy := Copy(OrderBy,Pos(' '+FieldPosRes+' ',OrderBy),Length(OrderBy)-Pos(' '+FieldPosRes+' ',OrderBy)+1);
       If (Pos(',',OrderBy)=0) then
        PastStr := ''
       else
        Begin
         PastStr := Copy(OrderBy,Pos(',',OrderBy),Length(OrderBy)-Pos(',',OrderBy)+1);
         OrderBy := Copy(OrderBy,1,Pos(',',OrderBy)-1)
        End;
       If (Pos('asc',OrderBy)>0) then
        OrderBy := ' '+FieldPosRes+' desc'
       else
        OrderBy := ' '+FieldPosRes+' asc';
       OrderBy := PreStr+OrderBy+PastStr
      End
     else
      Begin
       If (OrderBy<>'') then
        OrderBy := OrderBy+', '+FieldPosRes+' asc'
       else
        OrderBy := ' '+FieldPosRes+' asc';
      End
    end
   else
    Begin
     If (Pos(' '+FieldPosRes+' ',OrderBy)>0) then
      If (Pos('asc',OrderBy)>0) then
       OrderBy := ' '+FieldPosRes+' desc'
      else
       OrderBy := ' '+FieldPosRes+' asc'
     else
      OrderBy := ' '+FieldPosRes+' asc';
    End;
   GenerateSelect;
   ((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).Open;
   try
    ((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).BookMark := BookMark
   except
   end 
  End
end;

procedure wwDBGridCalcTitleImage(Sender: TObject; Field: TField;
                                 var TitleImageAttributes: TwwTitleImageAttributes;
                                 OrderBy : String);
var FieldPosRes, PartOrderBy : String;
begin
 TitleImageAttributes.ImageIndex := -1;
 FieldPosRes := FieldPos(Field.FieldName,((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).SelectSQL);
 If (Field <> nil) and (((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).Active) and
    (Pos(' '+FieldPosRes+' ',OrderBy)>0) then
  Begin
   PartOrderBy := Copy(OrderBy,Pos(' '+FieldPosRes+' ',OrderBy),Length(OrderBy)-Pos(' '+FieldPosRes+' ',OrderBy)+1);
   If (Pos(',',PartOrderBy)<>0) then
    PartOrderBy := Copy(PartOrderBy,1,Pos(',',PartOrderBy)-1);
   If (Pos('asc',PartOrderBy)>0) then
    TitleImageAttributes.ImageIndex := 0
   else
    TitleImageAttributes.ImageIndex := 1;
  End
end;

function FieldPosNumber(FieldPosRes, OrderBy: String): String;
 var k : Integer;
begin
 Result := '';
 OrderBy := OrderBy+',';
 k := 0;
 While (Length(OrderBy)>0) do
  Begin
   Inc(k);
   If (Pos(' '+FieldPosRes+' ',Copy(OrderBy,1,Pred(Pos(',',OrderBy))))>0) then
    Begin
     If (Copy(OrderBy,Succ(Pos(',',OrderBy)),Length(OrderBy)-Pos(',',OrderBy))<>'') or (k>1) then
      Result := IntToStr(k)+': ';
     Break
    End;
   OrderBy := Copy(OrderBy,Succ(Pos(',',OrderBy)),Length(OrderBy)-Pos(',',OrderBy))
  End
end;

procedure wwDBGridCalcTitleAttributes(Sender: TObject;
  AFieldName, AFieldNameReal: String; AFont: TFont; ABrush: TBrush;
  var ATitleAlignment: TAlignment; OrderBy: String);
 var FieldPosRes, Number : String;
begin
 FieldPosRes := FieldPos(AFieldNameReal,((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).SelectSQL);
 Number := FieldPosNumber(FieldPosRes, OrderBy);
 If (((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).Active) and
     (Pos(' '+FieldPosRes+' ',OrderBy)>0) then
  Begin
   If ((Sender as TwwDBGrid).UseTFields) then
    Begin
     If (Number='') or (Copy(((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel,1,Length(Number))<>Number) then
      Begin
       If (Pos(': ',((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel)>0) then
        Begin
         ((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel := Copy(((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel,Pos(': ',((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel)+2,Length(((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel)-Pos(': ',((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel)-1);
        End;
       If (Number<>'') then
        ((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel := Number+((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel
      End
    End
   else
    If (Number='') or (Copy((Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel,1,Length(Number))<>Number) then
     Begin
      If (Pos(': ',(Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel)>0) then
       Begin
       (Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel := Copy((Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel,Pos(': ',(Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel)+2,Length((Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel)-Pos(': ',(Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel)-1)
       End;
      If (Number<>'') then
       (Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel := Number+(Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel
     End
  End
 else
  If (Pos(': ',(Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel)>0) then
   Begin
     If ((Sender as TwwDBGrid).UseTFields) then
      ((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel := Copy(((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel,Pos(': ',((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel)+2,Length(((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel)-Pos(': ',((Sender as TwwDBGrid).DataSource.DataSet as TIBDataSet).FieldByName(AFieldName).DisplayLabel)-1)
     else
      (Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel := Copy((Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel,Pos(': ',(Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel)+2,Length((Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel)-Pos(': ',(Sender as TwwDBGrid).ColumnByName(AFieldName).DisplayLabel)-1)
   End
end;

procedure ibdsAfterScroll(DataSet: TDataSet; Form: TForm; Suf: String);
 var ki : Integer;
begin
 If (Form<>nil) then
  For ki :=0 to Pred(Form.ComponentCount) do
   If (Form.Components[ki] is TSpeedButton) then
    If (Form.Components[ki].Name='sbFirst'+Suf) or (Form.Components[ki].Name='sbPrior'+Suf) then
     (Form.Components[ki] as TControl).Enabled := Not DataSet.Bof
    else
     If (Form.Components[ki].Name='sbNext'+Suf) or (Form.Components[ki].Name='sbLast'+Suf) then
      (Form.Components[ki] as TControl).Enabled := Not DataSet.EOF
     else
     If (Form.Components[ki].Name='sbDelete'+Suf) then
      (Form.Components[ki] as TControl).Enabled := Not (DataSet.Bof and DataSet.Eof)
end;

function GetStartDate(Number_Restart_Period: Integer; Date: TDateTime): TDate;
 var Year, Month, Day : Word;
begin
 Case Number_Restart_Period of
  0 : Result := 0;
  1 : Result := Date;
  2 : Result := Date-DayOfWeek(Date)+2;
//3 :
  4 : Begin
       DecodeDate(Date,Year,Month,Day);
       Result := EncodeDate(Year,Month,1)
      End;
//5 :
  6 : Begin
       DecodeDate(Date,Year,Month,Day);
       Result := EncodeDate(Year,1,1)
      End
 end
end;

function GetStopDate(Number_Restart_Period: Integer; Date: TDateTime): TDate;
 var Year, Month, Day : Word;
begin
 Case Number_Restart_Period of
  0 : Result := EncodeDate(2100,12,30);
  1 : Result := Date;
  2 : Result := Date+9-DayOfWeek(Date);
//3 :
  4 : Begin
       DecodeDate(Date,Year,Month,Day);
       If (Month=12) then
        Result := EncodeDate(Year+1,1,1)
       else
        Result := EncodeDate(Year,Month+1,1)
      End;
//5 :
  6 : Begin
       DecodeDate(Date,Year,Month,Day);
       Result := EncodeDate(Year+1,1,1)
      End
 end
end;

function ReplaceDateStr(InStr: String; Date: TDateTime): String;
Begin
 Result := ReplaceStr(InStr,'ää',FormatDateTime('dd',Date));
 Result := ReplaceStr(Result,'ìì',FormatDateTime('mm',Date));
 Result := ReplaceStr(Result,'ãããã',FormatDateTime('yyyy',Date));
 Result := ReplaceStr(Result,'ãã',FormatDateTime('yy',Date))
End;

procedure wwDBGridCalcCellColors2(Sender: TObject;
  Field: TField; State: TGridDrawState; Highlight: Boolean; AFont: TFont;
  ABrush: TBrush);
begin
 If NOT (Highlight) then
  If (Field.CanModify) then
   ABrush.Color := clWindow
  else
   ABrush.Color := ColorUnModify
end;

procedure wwDBGridCalcCellColors3(Sender: TObject;
  Field: TField; State: TGridDrawState; Highlight: Boolean; AFont: TFont;
  ABrush: TBrush);
begin
 If NOT (Highlight) then
  Begin
   AFont.Style := [];
   ABrush.Color := clWindow;
  End
end;

function GeneratePrice(BasePrice: Double; PriceFormula: String; Percent: Double; GetNSP: Integer; NSP: Double): Double;
begin
 Result := BasePrice*(1+Percent/100)*(1+GetNSP*NSP/100)
end;

procedure sbPrintClick(Sender: TComponent; ibsAux: TIBSQL; ibDataSet : TIBDataSet);
 var PopUpMenu : TPopupMenu;
     MenuItem : TMenuItem;
     k : Integer;
begin
 ibsAux.SQL.Clear;
 ibsAux.SQL.Add('select R.ID, R.REPORT_NAME');
 ibsAux.SQL.Add('from REPORTS R, REPORTS_SHOING RS');
 ibsAux.SQL.Add('where (R.ID=RS.REPORT_ID) and (RS.BUTTON_NAME='#39+ibsAux.Owner.Name+'/'+Sender.Name+'/'+IntToStr(Sender.Tag)+#39') order by 2');
 PopUpMenu := TPopupMenu.Create(Sender);
 ibsAux.ExecQuery;
 While NOT (ibsAux.Eof) do
  Begin
   MenuItem := TMenuItem.Create(PopUpMenu);
   MenuItem.Caption := ibsAux.FieldByName('REPORT_NAME').AsString;
   MenuItem.Tag := ibsAux.FieldByName('ID').AsInteger;
   MenuItem.OnClick := frmMain.PopUpPrintMenuItemClick;
   PopUpMenu.Items.Add(MenuItem);
   ibsAux.Next
  End;
 ibsAux.Close;
 MenuItem := TMenuItem.Create(PopUpMenu);
 MenuItem.Caption := '-';
 PopUpMenu.Items.Add(MenuItem);
 MenuItem := TMenuItem.Create(PopUpMenu);
 MenuItem.Caption := 'Ñîçäàòü íîâûé';
 MenuItem.OnClick := frmMain.PopUpPrintMenuItemClick;
 PopUpMenu.Items.Add(MenuItem);
 PopUpMenu.Popup(Mouse.CursorPos.x,Mouse.CursorPos.y);
 frmMain.frReport.Dictionary.DisabledDatasets.Clear;
 frmMain.frReport.Dictionary.DisabledDatasets.Add('frmDM.ibdsReport');
 frmMain.frReport.Dictionary.DisabledDatasets.Add('frmDM.ibdsShow');
 For k := 0 to Pred(frmMain.ComponentCount) do
  If (frmMain.Components[k] is TForm) then
   If (ibDataset=nil) or (ibDataset.Owner<>(frmMain.Components[k] as TForm)) then
    frmMain.frReport.Dictionary.DisabledDatasets.Add((frmMain.Components[k] as TForm).Name+'*');
 If (ibDataset=nil) then
  frmMain.frReport.Dataset := nil
 else
  frmMain.frReport.Dataset := frmMain.frDBDataSet;
 frmMain.frDBDataSet.DataSet := ibDataSet
end;

//-----------------------------------------------------------------------//
// Íàçíà÷åíèå : Âîçâðàùàåò ñóììó ïðîïèñüþ
// Ïàðàìåòðû :
// nSum : 		Ñóììà, êîòîðàÿ áóäåò ïåðåâåäåíà â ïðîïèñü
// cTxt1 :  		Åäèíèöà èçìåðåíèÿ, íàïðèìåð: ÐÓÁËÜ
// cTxt2 :  		Åäèíèöà èçìåðåíèÿ, íàïðèìåð: ÐÓÁËß
// cTxt3 :  		Åäèíèöà èçìåðåíèÿ, íàïðèìåð: ÐÓÁËÅÉ
// nTypeWrite : 	Ðîä åäèíèöû èçìåðåíèÿ (1-ìóæ, 2-æåí)
//
function CurrencyToStr (nSum : Longint; cTxt1,cTxt2,cTxt3 : String; nTypeWrite : Byte) : String;
Var aTxtMeasure,aTxtThousand,aTxtMillion,aTxtBillion,aTxtTrillion : array [1..3] of String;
    aTxtHundred, aTxtTen, aTxtExclude : array [0..9] of String;
    aTxtOne : array [0..9,1..2] of String;
    aTxtSum, aTextInWords : array [1..5] of String;
    nPos, nPos2, nTypeAddition : Integer;
    cSum, cText : String;
 Begin
 //------------------------------------Îïðåäåëÿåì êîíñòàíòû ðàçìåðíîñòåé-------------------------
 //Ìàññèâû íàïèñàíèÿ ðàçìåðíîñòåé

 aTxtMeasure[1] := cTxt1;
 aTxtMeasure[2] := cTxt2;
 aTxtMeasure[3] := cTxt3;
 //Òûñÿ÷è
 aTxtThousand[1] := 'òûñÿ÷à';
 aTxtThousand[2] := 'òûñÿ÷è';
 aTxtThousand[3] := 'òûñÿ÷';
 //Ìèëëèîíû
 aTxtMillion[1] := 'ìèëëèîí';
 aTxtMillion[2] := 'ìèëëèîíà';
 aTxtMillion[3] := 'ìèëëèîíîâ';
 //Ìèëëèàðä
 aTxtBillion[1] := 'ìèëëèàðä';
 aTxtBillion[2] := 'ìèëëèàðäà';
 aTxtBillion[3] := 'ìèëëèàðäîâ';
 //Òðèëëèîíû
 aTxtTrillion[1] := 'òðèëëèîí';
 aTxtTrillion[2] := 'òðèëëèîíà';
 aTxtTrillion[3] := 'òðèëëèîíîâ';

 //--------------------------------Îïðåäåëÿåì ìàññèâû íàïèñàíèÿ ÷èñåë-------------------------
 //Ìàññèâ çíà÷åíèé 0-9 â ñîòíÿõ
 aTxtHundred[0] := '';
 aTxtHundred[1] := 'ñòî';
 aTxtHundred[2] := 'äâåñòè';
 aTxtHundred[3] := 'òðèñòà';
 aTxtHundred[4] := '÷åòûðåñòà';
 aTxtHundred[5] := 'ïÿòüñîò';
 aTxtHundred[6] := 'øåñòüñîò';
 aTxtHundred[7] := 'ñåìüñîò';
 aTxtHundred[8] := 'âîñåìüñîò';
 aTxtHundred[9] := 'äåâÿòüñîò';
 //Ìàññèâ çíà÷åíèé 0-9 â äåñÿòêàõ
 aTxtTen[0] := '';
 aTxtTen[1] := '';
 aTxtTen[2] := 'äâàäöàòü';
 aTxtTen[3] := 'òðèäöàòü';
 aTxtTen[4] := 'ñîðîê';
 aTxtTen[5] := 'ïÿòüäåñÿò';
 aTxtTen[6] := 'øåñòüäåñÿò';
 aTxtTen[7] := 'ñåìüäåñÿò';
 aTxtTen[8] := 'âîñåìüäåñÿò';
 aTxtTen[9] := 'äåâÿíîñòî';
 //Ìàññèâ çíà÷åíèé ÷èñåë 10-19
 aTxtExclude[0] := 'äåñÿòü';
 aTxtExclude[1] := 'îäèííàäöàòü';
 aTxtExclude[2] := 'äâåíàäöàòü';
 aTxtExclude[3] := 'òðèíàäöàòü';
 aTxtExclude[4] := '÷åòûðíàäöàòü';
 aTxtExclude[5] := 'ïÿòíàäöàòü';
 aTxtExclude[6] := 'øåñòíàäöàòü';
 aTxtExclude[7] := 'ñåìíàäöàòü';
 aTxtExclude[8] := 'âîñåìíàäöàòü';
 aTxtExclude[9] := 'äåâÿòíàäöàòü';
 //Ìàññèâ çíà÷åíèé 0-9 äëÿ åäèíèö (äâà âàðèàíòà äëÿ ìóæñêîãî è æåíñêîãî ðîäà)
 aTxtOne[0,1]:= '';
 aTxtOne[1,1] := 'îäèí';
 aTxtOne[2,1] := 'äâà';
 aTxtOne[3,1] := 'òðè';
 aTxtOne[4,1] := '÷åòûðå';
 aTxtOne[5,1] := 'ïÿòü';
 aTxtOne[6,1] := 'øåñòü';
 aTxtOne[7,1] := 'ñåìü';
 aTxtOne[8,1] := 'âîñåìü';
 aTxtOne[9,1] := 'äåâÿòü';
 aTxtOne[0,2] := '';
 aTxtOne[1,2] := 'îäíà';
 aTxtOne[2,2] := 'äâå';
 For nPos:=3 to 9 do aTxtOne[nPos,2] := aTxtOne[nPos,1];

 //Ñîçäàåì ìàññèâ òðåõçíà÷íûõ ÷èñåë ïî ãðóïïàì
 // 1 - åäèíèöû
 // 2 - òûñÿ÷è
 // 3 - ìèëëèîíû
 // 4 - ìèëëèàðäû
 // 5 - òðèëëèîíû
 // aTxtSum[5]
 //Ïåðåâîäèì ñóììó â ÷èñëîâîé òèï äàííûõ
 cSum := IntToStr(nSum);
 //Ðàçáèâàåì ñóììó íà òðåõçíà÷íûå ÷àñòè è ïåðåäàåì èõ â ìàññèâ
 For nPos:=1 to 5 do
  For nPos2:=1 to 3 do
   If ((Pred(nPos)*3+nPos2)<=Length(cSum)) then
    aTxtSum[nPos] := cSum[Length(cSum)-(Pred(nPos)*3+Pred(nPos2))]+aTxtSum[nPos]
   Else
    aTxtSum[nPos] := '0'+aTxtSum[nPos];

 //Ñîçäàåì ìàññèâ ïðîïèñè ïî òðåõçíà÷íûì ÷èñëàì:
 // 1 - åäèíèöû
 // 2 - òûñÿ÷è
 // 3 - ìèëëèîíû
 // 4 - ìèëëèàðäû
 // 5 - òðèëëèîíû
 //Ìàññèâ ïðîïèñíûõ ÷èñåë
 //aTextInWords(5)

 //Öèêë ïî òðåõçíà÷íûì ãðóïïàì
 For nPos:=1 to 5 do
  If (aTxtSum[nPos]='000') then
   aTextInWords[nPos] := ''
  Else
   Begin
    cText := aTxtHundred[StrToInt(aTxtSum[nPos][1])];
    If (aTxtSum[nPos][2]='1') then
     cText := cText+' '+aTxtExclude[StrToInt(aTxtSum[nPos][3])]
    Else
     Begin
      cText := cText+' '+aTxtTen[StrToInt(aTxtSum[nPos][2])];
      If (nPos=2) then
       cText := cText+' '+aTxtOne[StrToInt(aTxtSum[nPos][3]),2]
      Else
       cText := cText+' '+aTxtOne[StrToInt(aTxtSum[nPos][3]),nTypeWrite]
     End;
    //Îïðåäåëÿåì òèï íàïèñàíèÿ ðàçìåðíîñòè:
    // 1 = "ðóáëü"
    // 2 = "ðóáëÿ"
    // 3 = "ðóáëåé"
    Case aTxtSum[nPos][3] of
     '1'     : nTypeAddition := 1;
     '2'..'4': nTypeAddition := 2;
    Else
     nTypeAddition := 3
    End;
    If (aTxtSum[nPos][2]='1') then nTypeAddition := 3;
    //Îïðåäåëÿåì ïðîïèñíîé òåêñò åäèíèöû èçìåðåíèÿ
    Case nPos of
     1 : cText := cText+' '+aTxtMeasure[nTypeAddition];
     2 : cText := cText+' '+aTxtThousand[nTypeAddition];
     3 : cText := cText+' '+aTxtMillion[nTypeAddition];
     4 : cText := cText+' '+aTxtBillion[nTypeAddition];
     5 : cText := cText+' '+aTxtTrillion[nTypeAddition]
    End;
    //Ðåçóëüòàò çàíîñèì â ìàññèâ ïðîïèñíûõ ÷èñåë
    aTextInWords[nPos] := cText;
   End;
 //Ñîáèðàåì ìàññèâ ïðîïèñè â îäíó ñòðîêó
 cText := '';
 For nPos:=5 downto 1 do
  Begin
   If (nPos=1) and (aTxtSum[nPos]='000') then
    aTextInWords[nPos] := aTextInWords[nPos]+aTxtMeasure[3];
   cText := cText+' '+aTextInWords[nPos]
  End;
 //Óäàëåíèå ëèøíèõ ïðîáåëîâ
 While (Pos('  ',cText)>0) do Delete(cText, Pos('  ',cText), 1);
 If (cText[1]=' ') then Delete(cText, 1, 1);
 //Ïåðâûé ñèìâîë ñòðîêè - çàãëàâíàÿ áóêâà
 If (nSum=0) then
  Result := '00 '+aTxtMeasure[3]
 Else
  Begin
   cSum := AnsiUpperCase(cText[1]);
   Delete(cText, 1, 1);
   Result := cSum + cText
  End
End;

procedure SetUserSelect(trMain : TIBTransaction; ibdsList : TIBDataSet;
                        ibsAux : TIBSQL; TableID : Integer);
var BookMark : String;
begin
 ibsAux.SQL.Clear;
 ibsAux.SQL.Add('insert into USERS_SELECT (TABLE_ID, ITEM_ID) values ('+IntToStr(TableID)+', :ITEM_ID)');
 ibsAux.GenerateParamNames := True;
 BookMark := ibdsList.Bookmark;
 ibdsList.DisableControls;
 ibdsList.First;
 While NOT (ibdsList.Eof) do
  Begin
   If (ibdsList.FieldByName('CHECKED').AsInteger=1) then
    Begin
     ibsAux.ParamByName('ITEM_ID').AsInteger := (ibdsList.FieldByName('ID') as TLargeintField).AsInteger;
     ibsAux.ExecQuery
    End;
   ibdsList.Next
  End;
// try
  trMain.CommitRetaining;
{ except
 end;}
 try
  ibdsList.Bookmark := BookMark
 finally
  ibdsList.EnableControls
 end
end;

procedure ReadUserSelect(ibdsList : TIBDataSet; ibsAux : TIBSQL; TableID : Integer);
var BookMark : String;
begin
 ibsAux.SQL.Clear;
 ibsAux.SQL.Add('select US.ITEM_ID from USERS_SELECT US');
 ibsAux.SQL.Add('where (US.USER_NAME=current_user) and (US.TABLE_ID=:TABLE_ID)');
 ibsAux.GenerateParamNames := True;
 ibsAux.ParamByName('TABLE_ID').AsInteger := TableID;
 ibsAux.ExecQuery;
 BookMark := ibdsList.Bookmark;
 ibdsList.DisableControls;
 While NOT (ibsAux.Eof) do
  Begin
   If (ibdsList.Locate('ID',ibsAux.FieldByName('ITEM_ID').AsString,[])) then
    Begin
     ibdsList.Edit;
     ibdsList.FieldByName('CHECKED').AsInteger := 1;
     ibdsList.Post
    End;
   ibsAux.Next
  End;
 ibsAux.Close;
 try
  ibdsList.Bookmark := BookMark
 finally
  ibdsList.EnableControls
 end
end;

procedure GridDBTableViewCustomDrawColumnHeader(Sender: TcxGridDBTableView;
          ACanvas: TcxCanvas; AViewInfo: TcxGridColumnHeaderViewInfo);
begin
 If (AViewInfo.Column.SortIndex<>-1) and
    (Pos(IntToStr(Succ(AViewInfo.Column.SortIndex))+': ',AViewInfo.Text)<>1) then
  AViewInfo.Text := IntToStr(Succ(AViewInfo.Column.SortIndex))+': '+AViewInfo.Text
end;

function ReplaceStr(const S, Srch, Replace: string): string;
var
  I: Integer;
  Source: string;
begin
  Source := S;
  Result := '';
  repeat
    I := Pos(Srch, Source);
    if I > 0 then begin
      Result := Result + Copy(Source, 1, I - 1) + Replace;
      Source := Copy(Source, I + Length(Srch), MaxInt);
    end
    else Result := Result + Source;
  until I <= 0;
end;

procedure AnsiLCase(var Source:AnsiString;const Index,Count:Integer);
  {Lower case Count characters in Source starting at Index considering
   Windows locale.}
var
  I:Integer;
begin
  if (Index<1) or (Index>Length(Source)) then Exit;
  I:=Length(Source)-Index+1;
  if (Count>0) AND (I>Count) then I:=Count;
  UniqueString(Source);
  CharLowerBuff(@Source[Index],I);
end;

procedure FlashMsg(const Title,Msg:AnsiString; TOut:Integer);
  {Dynamically create a timed message display form.}
var
  I,J:Integer;
begin
  with TForm.Create(Application) do begin
    Name := 'EFD_Msg';
    Caption := Title;
    Position := poScreenCenter;
    BorderStyle := bsDialog;
    FormStyle := fsStayOnTop;
    BorderIcons := [];
    Height := 64;
    I := Canvas.TextWidth(Msg);
    J := Canvas.TextHeight(Msg);
    Height := 5*J;
    Width := iMax(128,I + (I Shr 1));
    I := Left+((Width - I ) Shr 1);
    J := Top+J;
    Show;
    Canvas.Brush.Style := bsClear;
    Canvas.TextOut(I,J,Msg);
    I:=GetTickCount+DWord(TOut);
    repeat
      Application.ProcessMessages;
    until GetTickCount>DWord(I);
    Free;
  end;
end;

function  iMax(const I,J:Integer):Integer;
asm
  Cmp   EAX,EDX
  Jge   @Exit
  Mov   EAX,EDX
@Exit:
end;

function GetNewID(ibsGen_ID: TIBSQL; Gen_Name: String): Integer;
begin
 ibsGen_ID.SQL.Clear;
 ibsGen_ID.SQL.Add('select gen_id('+Gen_Name+',1) from rdb$database');
 ibsGen_ID.ExecQuery;
 Result := ibsGen_ID.FieldByName('Gen_ID').AsInteger;
 ibsGen_ID.Close
end;

procedure PostIfNeeded(IBDataSet: TIBDataSet);
begin
 If (IBDataSet.State in [dsEdit,dsInsert]) then
  IBDataSet.Post
end;

function GetPassword(lblText : String; var Password : String) : Boolean;
begin
 frmEnterPassword := TfrmEnterPassword.Create(frmMain);
 frmEnterPassword.lblText.Caption := lblText;
 frmEnterPassword.ShowModal;
 Password := frmEnterPassword.edPassword.Text;
 Result := (frmEnterPassword.ModalResult=mrOK);
 frmEnterPassword.Free
end;

{procedure LocaliseDevEx;
begin
//TcxGridPopupMenu
{ cxSetResourceString(@cxSGridAlignCenter, 'Âûðîâíÿòü ïî öåíòðó');
 cxSetResourceString(@cxSGridAlignLeft, 'Âûðîâíÿòü ïî ëåâîìó êðàþ');
 cxSetResourceString(@cxSGridAlignmentSubMenu, 'Âûðàâíèâàíèå');
 cxSetResourceString(@cxSGridAlignRight, 'Âûðîâíÿòü ïî ïðàâîìó êðàþ');
 cxSetResourceString(@cxSGridAvgMenuItem, 'Ñðåäíåå');
 cxSetResourceString(@cxSGridBestFit, 'Ïîäîãíàòü øèðèíó');
 cxSetResourceString(@cxSGridBestFitAllColumns, 'Ïîäîãíàòü øèðèíó (âñåõ ñòîëáöîâ)');
 cxSetResourceString(@cxSGridCountMenuItem, 'Âñåãî');
 cxSetResourceString(@cxSGridFieldChooser, 'Âûáîð ñòîëáöîâ');
 cxSetResourceString(@cxSGridGroupByBox, 'Ïàíåëü ãðóïïèðîâêè');
 cxSetResourceString(@cxSGridGroupByThisField, 'Ãðóïïèðîâàòü ïî ýòîìó ñòîëáöó');
 cxSetResourceString(@cxSGridMaxMenuItem, 'Ìàêñèìàëüíîå çíà÷åíèå');
 cxSetResourceString(@cxSGridMinMenuItem, 'Ìèíèìàëüíîå çíà÷åíèå');
 cxSetResourceString(@cxSGridNone, 'Íåò');
 cxSetResourceString(@cxSGridNoneMenuItem, 'Íåò');
 cxSetResourceString(@cxSGridRemoveColumn, 'Óäàëèòü ýòîò ñòîëáåö');
 cxSetResourceString(@cxSGridShowFooter, 'Èòîã');
 cxSetResourceString(@cxSGridShowGroupFooter, 'Èòîãè ãðóïï');
 cxSetResourceString(@cxSGridSortColumnAsc, 'Ñîðòèðîâàòü ïî âîçðàñòàíèþ');
 cxSetResourceString(@cxSGridSortColumnDesc, 'Ñîðòèðîâàòü ïî óáûâàíèþ');
 cxSetResourceString(@cxSGridSumMenuItem, 'Ñóììà');
//Express QuantumGrid
 cxSetResourceString(@scxGridCustomizationFormBandsPageCaption, 'Ãðóïïû');
 cxSetResourceString(@scxGridCustomizationFormCaption, 'Íàñòðîéêà');
 cxSetResourceString(@scxGridCustomizationFormColumnsPageCaption, 'Ñòîëáöû');
 cxSetResourceString(@scxGridDeletingConfirmationCaption, 'Ïîäòâåðæäåíèå');
 cxSetResourceString(@scxGridDeletingFocusedConfirmationText, 'Óäàëèòü ñòðîêó?');
 cxSetResourceString(@scxGridDeletingSelectedConfirmationText, 'Óäàëèòü âñå âûäåëåííûå ñòðîêè?');
 cxSetResourceString(@scxGridFilterCustomizeButtonCaption, 'Íàñòðîèòü...');
 cxSetResourceString(@scxGridFilterIsEmpty, 'Ôèëüòð ïóñò');
 cxSetResourceString(@scxGridGroupByBoxCaption, 'Ïåðåòàùèòå ñþäà çàãîëîâîê ñòîëáöà, ÷òîáû ñãðóïïèðîâàòü ïî íåìó');
 cxSetResourceString(@scxGridRecursiveLevels, '');
 cxSetResourceString(@scxNotExistGridLevel, 'Íåò àêòèâíîãî óðîâíÿ òàáëèöû');
//Express DataController
 cxSetResourceString(@cxSFilterAndCaption, 'è');
 cxSetResourceString(@cxSFilterBlankCaption, 'ïóñòî');
 cxSetResourceString(@cxSFilterBoxAllCaption, '(Âñå)');
 cxSetResourceString(@cxSFilterBoxBlanksCaption, '(Ïóñòûå)');
 cxSetResourceString(@cxSFilterBoxCustomCaption, '(Íåêîòîðûå...)');
 cxSetResourceString(@cxSFilterBoxNonBlanksCaption, 'ÍåÏóñòûå');
 cxSetResourceString(@cxSFilterNotCaption, 'íå');
 cxSetResourceString(@cxSFilterOperatorBeginsWith, 'íà÷èíàåòñÿ ñ');
 cxSetResourceString(@cxSFilterOperatorBetween, 'ìåæäó');
 cxSetResourceString(@cxSFilterOperatorContains, 'ñîäåðæèò');
 cxSetResourceString(@cxSFilterOperatorDoesNotBeginWith, 'íå íà÷èíàåòñÿ ñ');
 cxSetResourceString(@cxSFilterOperatorDoesNotContain, 'íå ñîäåðæèò');
 cxSetResourceString(@cxSFilterOperatorDoesNotEndWith, 'íå êîí÷àåòñÿ');
 cxSetResourceString(@cxSFilterOperatorEndsWith, 'êîí÷àåòñÿ');
 cxSetResourceString(@cxSFilterOperatorEqual, 'ðàâíî');
 cxSetResourceString(@cxSFilterOperatorGreater, 'áîëüøå ÷åì');
 cxSetResourceString(@cxSFilterOperatorGreaterEqual, 'áîëüøå èëè ðàâíî ÷åì');
 cxSetResourceString(@cxSFilterOperatorInList, 'â');
 cxSetResourceString(@cxSFilterOperatorIsNotNull, 'íå ïóñòî');
 cxSetResourceString(@cxSFilterOperatorIsNull, 'ïóñòî');
 cxSetResourceString(@cxSFilterOperatorLastMonth, 'â ïðîøëîì ìåñÿöå');
 cxSetResourceString(@cxSFilterOperatorLastWeek, 'íà ïðîøëîé íåäåëå');
 cxSetResourceString(@cxSFilterOperatorLastYear, 'â ïðîøëîì ãîäó');
 cxSetResourceString(@cxSFilterOperatorLess, 'ìåíüøå ÷åì');
 cxSetResourceString(@cxSFilterOperatorLessEqual, 'ìåíüøå èëè ðàâíî ÷åì');
 cxSetResourceString(@cxSFilterOperatorLike, 'ïîäîáíî');
 cxSetResourceString(@cxSFilterOperatorNextMonth, 'â ñëåäóþùåì ìåñÿöå');
 cxSetResourceString(@cxSFilterOperatorNextWeek, 'íà ñëåäóþùåé íåäåëå');
 cxSetResourceString(@cxSFilterOperatorNextYear, 'â ñëåäóþùåì ãîäó');
 cxSetResourceString(@cxSFilterOperatorNotBetween, 'íå ìåæäó');
 cxSetResourceString(@cxSFilterOperatorNotEqual, 'íå ðàâíî');
 cxSetResourceString(@cxSFilterOperatorNotInList, 'íå â');
 cxSetResourceString(@cxSFilterOperatorNotLike, 'íå ïîäîáíî');
 cxSetResourceString(@cxSFilterOperatorThisMonth, 'â ýòîì ìåñÿöå');
 cxSetResourceString(@cxSFilterOperatorThisWeek, 'íà ýòîé íåäåëå');
 cxSetResourceString(@cxSFilterOperatorThisYear, 'â ýòîì ãîäó');
 cxSetResourceString(@cxSFilterOperatorToday, 'ñåãîäíÿ');
 cxSetResourceString(@cxSFilterOperatorTomorrow, 'çàâòðà');
 cxSetResourceString(@cxSFilterOperatorYesterday, 'â÷åðà');
 cxSetResourceString(@cxSFilterOrCaption, 'èëè');
//Express Editors
 cxSetResourceString(@cxSBlobButtonCancel, '&Îòìåíà');
 cxSetResourceString(@cxSBlobButtonClose, '&Çàêðûòü');
 cxSetResourceString(@cxSBlobMemo, '(ÇÀÌÅÒÊÀ)');
 cxSetResourceString(@cxSBlobMemoEmpty, '(çàìåòêà)');
 cxSetResourceString(@cxSBlobPicture, '(ÊÀÐÒÈÍÊÀ)');
 cxSetResourceString(@cxSBlobPictureEmpty, '(êàðòèíêà)');
 cxSetResourceString(@cxSDateBOM, 'íì');
 cxSetResourceString(@cxSDateEOM, 'êì');
 cxSetResourceString(@cxSDateError, 'Íåâåðíàÿ äàòà');
 cxSetResourceString(@cxSDateFifth, 'ïÿòûé');
 cxSetResourceString(@cxSDateFirst, 'ïåðâûé');
 cxSetResourceString(@cxSDateFourth, '÷åòâåðòûé');
 cxSetResourceString(@cxSDateFriday, 'Ïÿòíèöà');
 cxSetResourceString(@cxSDateMonday, 'Ïîíåäåëüíèê');
 cxSetResourceString(@cxSDateNow, 'ñåé÷àñ');
 cxSetResourceString(@cxSDatePopupClear, 'Î÷èñòèòü');
 cxSetResourceString(@cxSDatePopupToday, 'Ñåãîäíÿ');
 cxSetResourceString(@cxSDateSaturday, 'Ñóááîòà');
 cxSetResourceString(@cxSDateSecond, 'âòîðîé');
 cxSetResourceString(@cxSDateSeventh, 'ñåäüìîé');
 cxSetResourceString(@cxSDateSixth, 'øåñòîé');
 cxSetResourceString(@cxSDateSunday, 'Âîñêðåñåíüå');
 cxSetResourceString(@cxSDateThird, 'òðåòèé');
 cxSetResourceString(@cxSDateThursday, '×åòâåðã');
 cxSetResourceString(@cxSDateToday, 'ñåãîäíÿ');
 cxSetResourceString(@cxSDateTomorrow, 'çàâòðà');
 cxSetResourceString(@cxSDateTuesday, 'Âòîðíèê');
 cxSetResourceString(@cxSDateWednesday, 'Ñðåäà');
 cxSetResourceString(@cxSDateYesterday, 'â÷åðà');
 cxSetResourceString(@cxSEditNumericValueConvertError, 'Íåâîçìîæíî ïðåîáðàçîâàòü ê öèôðîâîìó âèäó');
 cxSetResourceString(@cxSEditPopupCircularReferencingError, 'Öèêëè÷åñêèå ññûëêè íåäîïóñòèìû');
 cxSetResourceString(@cxSEditTimeConvertError, 'Íå ìîãó ïðèâåñòè êî âðåìåíè');
 cxSetResourceString(@cxSEditValidateErrorText, 'Íåâåðíîå çíà÷åíèå, èñïîëüçóéòå êëàâèøó Esc, ÷òîáû îòìåíèòü èçìåíåíèÿ');
 cxSetResourceString(@cxSEditValueOutOfBounds, 'Âåëè÷èíà âûõîäèò çà ãðàíèöû');
 cxSetResourceString(@cxSMenuItemCaptionCopy, '&Êîïèðîâàòü');
 cxSetResourceString(@cxSMenuItemCaptionCut, '&Âûðåçàòü');
 cxSetResourceString(@cxSMenuItemCaptionDelete, '&Óäàëèòü');
 cxSetResourceString(@cxSMenuItemCaptionLoad, '&Çàãðóçèòü...');
 cxSetResourceString(@cxSMenuItemCaptionPaste, 'Â&ñòàâèòü');
 cxSetResourceString(@cxSMenuItemCaptionSave, 'Ñîõðàíèòü ê&àê');
 cxSetResourceString(@scxRegExprCantUsePlusQuantifier, 'Çíàê ''+'' íå ìîæåò áûòü ïðèìåíåí çäåñü');
 cxSetResourceString(@scxRegExprCantUseStarQuantifier, 'Çíàê ''*'' íå ìîæåò áûòü ïðèìåíåí çäåñü');
 cxSetResourceString(@scxRegExprChar, 'Çíàê');
//string constants for filter controls and filter dialogs
 cxSetResourceString(@cxSFilterAddCondition, 'Äîáàâèòü óñëîâèå');
 cxSetResourceString(@cxSFilterAddGroup, 'Äîáàâèòü &ãðóïïó');
 cxSetResourceString(@cxSFilterBoolOperatorAnd, 'È');
 cxSetResourceString(@cxSFilterBoolOperatorNotAnd, 'ÍÅ È');
 cxSetResourceString(@cxSFilterBoolOperatorNotOr, 'ÍÅ ÈËÈ');
 cxSetResourceString(@cxSFilterBoolOperatorOr, 'ÈËÈ');
 cxSetResourceString(@cxSFilterClearAll, 'Î÷èñòèòü &âñå');
 cxSetResourceString(@cxSFilterControlDialogActionApplyCaption, 'Ïðèìåíèòü');
 cxSetResourceString(@cxSFilterControlDialogActionCancelCaption, 'Îòìåíèòü');
 cxSetResourceString(@cxSFilterControlDialogActionOpenCaption, '&Îòêðûòü...');
 cxSetResourceString(@cxSFilterControlDialogActionSaveCaption, '&Ñîõðàíèòü êàê');
 cxSetResourceString(@cxSFilterControlDialogCaption, 'Ïîñòðîèòåëü ôèëüòðà');
 cxSetResourceString(@cxSFilterControlDialogFileFilter, 'Ôèëüòðû (*.flt)|*.flt');
 cxSetResourceString(@cxSFilterControlDialogNewFile, 'íîâûé.flt');
 cxSetResourceString(@cxSFilterControlDialogOpenDialogCaption, 'Îòêðûòü ñóùåñòâóþùèé ôèëüòð');
 cxSetResourceString(@cxSFilterControlDialogSaveDialogCaption, 'Ñîõðàíèòü àêòèâíûé ôèëüòð â ôàéë');
 cxSetResourceString(@cxSFilterControlNullString, '<ïóñòî>');
 cxSetResourceString(@cxSFilterDialogCaption, 'Ñïåöèàëüíûé ôèëüòð');
 cxSetResourceString(@cxSFilterDialogCharactersSeries, 'äëÿ ïåðäñòàâëåíèÿ ëþáûõ ïîñëåäîâàòåëüíîñòåé ñèìâîëîâ');
 cxSetResourceString(@cxSFilterDialogInvalidValue, 'Íåâåðíîå çíà÷åíèå');
 cxSetResourceString(@cxSFilterDialogOperationAnd, 'È');
 cxSetResourceString(@cxSFilterDialogOperationOr, 'ÈËÈ');
 cxSetResourceString(@cxSFilterDialogRows, 'Ïîêàçàòü çàïèñè ãäå:');
 cxSetResourceString(@cxSFilterDialogSingleCharacter, 'äëÿ ïðåäñòàâëåíèÿ îäíîãî ëþáîãî ñèìâîëà');
 cxSetResourceString(@cxSFilterDialogUse, 'Èñïîëüçîâàòü');
 cxSetResourceString(@cxSFilterErrorBuilding, 'Íåâîçìîæíî ïîñòðîèòü ôèëüòð');
 cxSetResourceString(@cxSFilterFooterAddCondition, 'íàæìèòå, ÷òîáû äîáàâèòü íîâîå óñëîâèå');
 cxSetResourceString(@cxSFilterGroupCaption, 'ïðèìåíèòü äëÿ ñëåäóþùèõ óñëîâèé');
 cxSetResourceString(@cxSFilterRemoveRow, '&Óäàëèòü ñòðî÷êó');
 cxSetResourceString(@cxSFilterRootButtonCaption, 'Ôèëüòð');
 cxSetResourceString(@cxSFilterRootGroupCaption, '<êîðåíü>');
 cxSetResourceString(@cxSGridClearSorting, 'Ñíÿòü ñîðòèðîâêó');
 cxSetResourceString(@cxSGridRemoveThisGroupItem, 'Óáðàòü ãðóïïèðîâêó ïî ýòîìó ñòîëáöó');
// dxBars
 cxSetResourceString(@dxSBAR_LOOKUPDIALOGCAPTION, 'Âûáîð çíà÷åíèÿ');
 cxSetResourceString(@dxSBAR_LOOKUPDIALOGOK, 'OK');
 cxSetResourceString(@dxSBAR_LOOKUPDIALOGCANCEL, 'Îòìåíà');

 cxSetResourceString(@dxSBAR_DIALOGOK, 'OK');
 cxSetResourceString(@dxSBAR_DIALOGCANCEL, 'Îòìåíà');
 cxSetResourceString(@dxSBAR_DATETODAY, 'Ñåãîäíÿ');
 cxSetResourceString(@dxSBAR_DATECLEAR, 'Î÷èñòèòü');
 cxSetResourceString(@dxSBAR_DATEDIALOGCAPTION, 'Âûáîð äàòû');
 cxSetResourceString(@dxSBAR_TREEVIEWDIALOGCAPTION, 'Âûáîð ïóíêòà');
 cxSetResourceString(@dxSBAR_IMAGEDIALOGCAPTION, 'Âûáîð');
 cxSetResourceString(@dxSBAR_IMAGEINDEX, '¹ êàðòèíêè');
 cxSetResourceString(@dxSBAR_IMAGETEXT, 'Òåêñò');
 cxSetResourceString(@dxSBAR_PLACEFORCONTROL, 'Ìåñòî äëÿ ');

 cxSetResourceString(@dxSBAR_WANTTORESETTOOLBAR, 'Âû óâåðåíû, ÷òî õîòèòå îòìåíèòü èçìåíåíèÿ ïàíåëè ''%s'' ?');

 cxSetResourceString(@dxSBAR_CP_ADDSUBITEM, 'Äîáàâèòü Ïî&äïóíêò');
 cxSetResourceString(@dxSBAR_CP_ADDBUTTON, 'Äîáàâèòü &Êíîïêó');
 cxSetResourceString(@dxSBAR_CP_ADDITEM, 'Äîáàâèòü &Ïóíêò');
 cxSetResourceString(@dxSBAR_CP_DELETEBAR, 'Óäàëèòü ïàíåëü');

 cxSetResourceString(@dxSBAR_CP_RESET, '&Óìîë÷àíèÿ');
 cxSetResourceString(@dxSBAR_CP_DELETE, 'Ó&äàëèòü');
 cxSetResourceString(@dxSBAR_CP_NAME, '&Èìÿ:');
 cxSetResourceString(@dxSBAR_CP_CAPTION, '&Òåêñò:'); // is the same as dxSBAR_CP_NAME (at design-time)

 cxSetResourceString(@dxSBAR_ADDEX, 'Äîáàâèòü...');
 cxSetResourceString(@dxSBAR_RENAMEEX, 'Ïåðåèìåíîâàòü...');
 cxSetResourceString(@dxSBAR_DELETE, 'Óäàëèòü');
 cxSetResourceString(@dxSBAR_CLEAR, 'Î÷èñòèòü');
 cxSetResourceString(@dxSBAR_VISIBLE, 'Âèäèìûé');
 cxSetResourceString(@dxSBAR_OK, 'OK');
 cxSetResourceString(@dxSBAR_CANCEL, 'Îòìåíà');
 cxSetResourceString(@dxSBAR_INSERTEX, 'Âñòàâèòü...');

 cxSetResourceString(@dxSBAR_TOOLBARNEWNAME , 'Custom ');
 cxSetResourceString(@dxSBAR_CATEGORYADD , 'Add Category');
 cxSetResourceString(@dxSBAR_CATEGORYINSERT , 'Insert Category');
 cxSetResourceString(@dxSBAR_CATEGORYRENAME , 'Rename Category');
 cxSetResourceString(@dxSBAR_TOOLBARADD , 'Add Toolbar');
 cxSetResourceString(@dxSBAR_TOOLBARRENAME , 'Rename Toolbar');
 cxSetResourceString(@dxSBAR_CATEGORYNAME , '&Category name:');
 cxSetResourceString(@dxSBAR_TOOLBARNAME , '&Toolbar name:');
 cxSetResourceString(@dxSBAR_CUSTOMIZINGFORM, 'Customization Form...');

 cxSetResourceString(@dxSBAR_MODIFY, '... modify');
 cxSetResourceString(@dxSBAR_PERSMENUSANDTOOLBARS, 'Personalized Menus and Toolbars  ');
 cxSetResourceString(@dxSBAR_MENUSSHOWRECENTITEMS, 'Me&nus show recently used commands first');
 cxSetResourceString(@dxSBAR_SHOWFULLMENUSAFTERDELAY, 'Show f&ull menus after a short delay');
 cxSetResourceString(@dxSBAR_RESETUSAGEDATA, '&Reset my usage data');

{ sdxBarDatePopupToday := cxGetResourceString(@dxSBAR_DATETODAY);
 sdxBarDatePopupClear := cxGetResourceString(@dxSBAR_DATECLEAR);}
{end;}

procedure SetUpRegionalSettings;
begin
 ThousandSeparator := ' ';
 DecimalSeparator := ',';
 DateSeparator := '.';
 ShortDateFormat := 'dd.MM.yy';
 LongDateFormat := 'dd MMMM yyyy ã.';
 TimeSeparator := ':';
 ShortTimeFormat := 'HH:nn';
 LongTimeFormat := 'HH:nn:ss';
 ListSeparator := ';'
end;

function MyInputQuery(FormCaption, LabelCaption, InputMask : String; var Value : Integer) : Boolean;
begin
 frmInputQuery := TfrmInputQuery.Create(frmMain);
 frmInputQuery.Caption := FormCaption;
 frmInputQuery.lblText.Caption := LabelCaption;
 frmInputQuery.cxMaskEdit1.Properties.EditMask := InputMask;
 frmInputQuery.cxMaskEdit1.Text := IntToStr(Value);
 frmInputQuery.ShowModal;
 If (frmInputQuery.cxMaskEdit1.Text<>'') then
  Value := StrToInt(frmInputQuery.cxMaskEdit1.Text);
 Result := (frmInputQuery.ModalResult=mrOK);
 frmInputQuery.Free
end;

end.

